<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anava Local Network Bridge</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="bridge-container">
    <!-- Branded Header -->
    <header class="header">
      <div class="brand-identity">
        <div class="logo-mark">A</div>
        <div class="brand-text">
          <h1 class="brand-name">Anava</h1>
          <span class="product-subtitle">Local Bridge</span>
        </div>
      </div>
    </header>

    <!-- Status Card -->
    <div class="status-card">
      <div class="status-indicator" role="status" aria-live="polite" aria-atomic="true">
        <div class="status-dot" id="status-dot" aria-hidden="true">
          <div class="status-dot-inner"></div>
        </div>
        <div class="status-info">
          <div class="status-text" id="status-text">Checking connection...</div>
          <div class="status-description" id="status-description">Verifying bridge components</div>
        </div>
      </div>
    </div>

    <!-- Action Section -->
    <div class="action-section">
      <a
        href="#"
        id="open-web-app"
        class="btn-primary"
        target="_blank"
        aria-label="Open Anava Deployer web application"
        aria-describedby="action-description"
      >
        <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <path d="M14 9V13.5C14 14.3284 13.3284 15 12.5 15H2.5C1.67157 15 1 14.3284 1 13.5V3.5C1 2.67157 1.67157 2 2.5 2H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M10 1H15M15 1V6M15 1L8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Open Anava Deployer</span>
      </a>
      <p class="action-description" id="action-description">Deploy and manage cameras from the web interface</p>
    </div>

    <!-- Connection Details -->
    <div class="connection-details">
      <div class="section-header">
        <h3 class="section-title">System Status</h3>
      </div>

      <div class="status-grid">
        <div class="status-item">
          <div class="status-item-header">
            <svg class="status-icon" width="14" height="14" viewBox="0 0 14 14" aria-hidden="true">
              <circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="7" cy="7" r="3" fill="currentColor"/>
            </svg>
            <span class="status-item-label">Proxy Server</span>
          </div>
          <span class="status-item-value checking" id="proxy-status">Checking...</span>
        </div>

        <div class="status-item">
          <div class="status-item-header">
            <svg class="status-icon" width="14" height="14" viewBox="0 0 14 14" aria-hidden="true">
              <path d="M7 1C10.866 1 14 4.134 14 8C14 11.866 10.866 15 7 15C3.134 15 0 11.866 0 8C0 4.134 3.134 1 7 1Z" fill="none" stroke="currentColor" stroke-width="1.5"/>
              <path d="M7 1C8.5 1 9.5 4.134 9.5 8C9.5 11.866 8.5 15 7 15C5.5 15 4.5 11.866 4.5 8C4.5 4.134 5.5 1 7 1Z" fill="none" stroke="currentColor" stroke-width="1.5"/>
              <path d="M1 8H13" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            <span class="status-item-label">Web App</span>
          </div>
          <span class="status-item-value checking" id="web-app-status">Checking...</span>
        </div>
      </div>

      <div class="extension-info">
        <span class="info-label">Extension ID</span>
        <code class="info-code" id="extension-id">Loading...</code>
      </div>
    </div>

    <!-- Migration Notice (shown if old version detected) -->
    <div id="migration-required" class="alert-banner alert-info" style="display: none;">
      <div class="alert-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M10 6V11M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z"
            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="alert-content">
        <h3 class="alert-title">⚠️ Upgrade Available</h3>
        <div class="alert-message">
          <p>An older version of the Anava Local Connector was detected on your system.</p>
          <p>Please upgrade to the new version for improved stability and automatic updates.</p>
        </div>
        <button id="upgrade-now" class="btn-secondary" style="margin-top: 12px;">
          <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M8 13V3M8 3L4 7M8 3L12 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Download New Version</span>
        </button>
        <details style="margin-top: 12px;">
          <summary style="cursor: pointer; color: var(--text-secondary); font-size: 0.875rem;">Manual cleanup (optional)</summary>
          <div style="margin-top: 8px; padding: 8px; background: var(--bg-secondary); border-radius: 6px;">
            <p style="font-size: 0.8125rem; margin-bottom: 8px;">The old version can be safely removed by running:</p>
            <code style="display: block; padding: 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 0.75rem; overflow-x: auto;">
              curl -sSL https://connect.anava.cloud/uninstall-old.sh | bash
            </code>
            <p style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 8px;">
              Or download the script from: <a href="https://connect.anava.cloud/uninstall-old.sh" target="_blank">uninstall-old.sh</a>
            </p>
          </div>
        </details>
      </div>
    </div>

    <!-- Setup Instructions (shown if not fully connected) -->
    <div id="setup-instructions" class="alert-banner alert-warning" style="display: none;">
      <div class="alert-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M10 6V11M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z"
            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="alert-content">
        <h3 class="alert-title">Setup Required</h3>
        <div id="instructions-text" class="alert-message">
          <p>Checking connection status...</p>
        </div>
        <!-- Start Proxy Button (shown when proxy is not running) -->
        <button id="start-proxy-btn" class="btn-secondary" style="display: none; margin-top: 12px;">
          <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M5 3L12 8L5 13V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="currentColor"/>
          </svg>
          <span id="start-proxy-text">Start Proxy Server</span>
        </button>
        <div id="start-proxy-status" class="status-message" style="display: none; margin-top: 8px;"></div>
      </div>
    </div>

  </div>

  <script type="module" src="popup.js"></script>
</body>
</html>
